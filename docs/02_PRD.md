# 02 - 产品需求文档 (PRD)

> **范围**: 所有功能详细规格  
> **目标**: 开发实现依据  
> **最后更新**: 2026-02-19

---

## 一、核心剪贴板功能

### 1.1 支持的内容类型

| 类型 | 标识 | 存储方式 | 显示方式 |
|------|------|----------|----------|
| **纯文本** | `text` | 数据库 | 文本预览（3行） |
| **HTML** | `html` | 数据库 | 纯文本预览（去标签） |
| **RTF** | `rtf` | 数据库 | 纯文本预览 |
| **图片** | `image` | 文件系统缩略图 | 缩略图 + 尺寸 |
| **文件** | `file` | 路径存储 | 图标 + 文件名 |
| **文件夹** | `folder` | 路径存储 | 文件夹图标 + 路径 |
| **多文件** | `files` | 路径列表 JSON | 前3个文件名 |

### 1.2 数据处理流程

```
剪贴板变化
    │
    ├─→ 文本/HTML/RTF → 提取纯文本 → SHA256 哈希 → SQLite
    │
    ├─→ 图片 → 获取数据 → 生成缩略图(200x200 PNG) → 存文件系统 → SQLite 存路径
    │
    └─→ 文件/文件夹 → 获取路径 → 判断类型 → SQLite 存路径+元数据
```

### 1.3 缩略图规格

- **尺寸**: 200x200px
- **格式**: PNG
- **质量**: 80%
- **路径**: `{app_data}/thumbnails/{item_id}.png`
- **加载**: 使用 `convertFileSrc` 转换为可访问 URL

### 1.4 数据去重

- 基于内容 SHA256 哈希
- 重复内容更新 `created_at` 并置顶
- 可选：保留原始创建时间

---

## 二、UI 界面规格

### 2.1 剪贴板窗口布局

```
┌─ Clipboard Window (800x600) ──────────────────────────┐
│  ┌─ Header ─────────────────────────────────────────┐ │
│  │ [搜索框]                     [设置] [关闭]        │ │
│  └──────────────────────────────────────────────────┘ │
│  ┌─ Tabs ───────────────────────────────────────────┐ │
│  │ [全部] [文本] [HTML] [图片] [文件]               │ │
│  └──────────────────────────────────────────────────┘ │
│  ┌─ List Area ──────────────────────────────────────┐ │
│  │ ┌─ Item 1 ─────────────────────────────────────┐ │ │
│  │ │ [text] 这是剪贴板内容预览...          [1]    │ │ │
│  │ │        100字符 · 10:30 · [标签1] [标签2]      │ │ │
│  │ └──────────────────────────────────────────────┘ │ │
│  │ ┌─ Item 2 ─────────────────────────────────────┐ │ │
│  │ │ [image] [缩略图] 1920x1080 · PNG      [2]    │ │ │
│  │ │        [工作] [截图]                          │ │ │
│  │ └──────────────────────────────────────────────┘ │ │
│  │ ...                                             │ │
│  └──────────────────────────────────────────────────┘ │
│  ┌─ Status Bar ─────────────────────────────────────┐ │
│  │ 共 100 条记录                                    │ │
│  └──────────────────────────────────────────────────┘ │
└───────────────────────────────────────────────────────┘
```

### 2.2 剪贴板列表项 (ClipboardItem)

**布局**:
```
┌─ Clipboard Item ──────────────────────────────────────────┐
│ ┌─ Main Area ───────────────────────────────────────────┐ │
│ │ [类型标签] [内容预览区]                      [序号]   │ │
│ │            [元信息: 字符数·时间·标签列表]              │ │
│ └───────────────────────────────────────────────────────┘ │
│ ┌─ Hover Actions ───────────────────────────────────────┐ │
│ │ [详情] [添加到队列] [复制] [标签] [删除]              │ │
│ └───────────────────────────────────────────────────────┘ │
└───────────────────────────────────────────────────────────┘
```

**内容预览规则**:
| 类型 | 预览内容 | 最大行数 |
|------|----------|----------|
| text | 纯文本内容 | 3行 |
| html | 去标签后的纯文本 | 3行 |
| rtf | 提取的纯文本 | 3行 |
| image | 缩略图 + 尺寸 | 自适应 |
| file | 文件图标 + 文件名 | 1行 |
| folder | 文件夹图标 + 文件夹名 | 1行 |
| files | 文件数量 + 前3个文件名 | 3行 |

**类型标签样式**:
| 类型 | 背景色 | 文字色 |
|------|--------|--------|
| text | `#fff2e8` | `#fa8c16` |
| html | `#e6f7ff` | `#1890ff` |
| rtf | `#f6ffed` | `#52c41a` |
| image | `#f6ffed` | `#52c41a` |
| file | `#f9f0ff` | `#722ed1` |
| folder | `#f9f0ff` | `#722ed1` |
| files | `#fff0f6` | `#eb2f96` |

**元信息格式**:
- 文本类: `{字符数}字符 · {时间} · [标签列表]`
- 图片类: `{宽度}x{高度} · {格式} · {时间} · [标签列表]`
- 文件类: `{文件大小} · {时间} · [标签列表]`
- 文件夹类: `{项目数}个项目 · {时间} · [标签列表]`
- 多文件类: `{文件数}个文件 · {时间} · [标签列表]`

---

## 三、搜索功能

### 3.1 搜索框

- **位置**: 可配置 (顶部/底部)
- **占位符**: "搜索剪贴板历史..."
- **清除按钮**: 输入不为空时显示 X
- **快捷键**: `/` 或 `Ctrl+F` 聚焦

### 3.2 模糊搜索

- 支持拼音搜索（"hb" 匹配 "花瓣"）
- 支持首字母搜索
- 容错匹配（编辑距离）
- 按时间倒序排列

### 3.3 智能搜索语法

| 语法 | 示例 | 说明 |
|------|------|------|
| `@标签名` | `@工作` | 搜索包含该标签的项 |
| `@类型` | `@图片` | 按类型过滤 |
| 组合搜索 | `设计 @工作` | 关键词 + 标签 |
| 组合搜索 | `@图片 @截图` | 类型 + 标签 |

**类型简写**:
- `@文本` / `@text` → text/html/rtf
- `@图片` / `@image` → image
- `@文件` / `@file` → file/folder/files

### 3.4 搜索建议面板

```
┌─ Search Suggestions ────────────────────────┐
│  最近搜索                                   │
│  ├─ 关键词1                          [×]    │
│  ├─ @工作                              [×]    │
│  └─ 清空历史                                │
│  ─────────────────────────────────────────  │
│  热门标签                                   │
│  [工作] [截图] [代码] [链接]                │
│  ─────────────────────────────────────────  │
│  搜索语法提示                               │
│  • @标签名 - 按标签搜索                     │
│  • @类型 - 按类型搜索 (@文本/@图片)         │
└─────────────────────────────────────────────┘
```

### 3.5 标签页过滤

| 标签页 | 显示内容 |
|--------|----------|
| **全部** | 所有类型 |
| **文本** | text + html + rtf |
| **HTML** | 仅 html |
| **图片** | 仅 image |
| **文件** | file + files |

---

## 四、交互操作

### 4.1 鼠标操作

| 操作 | 默认行为 | 可配置 |
|------|----------|--------|
| **左键单击** | 复制 | ✅ `click_action` |
| **左键双击** | 粘贴 | ✅ `double_click_action` |
| **右键** | 上下文菜单 | ❌ |
| **拖拽** | 跨应用拖拽 | ❌ |

**动作说明**:
- **复制**: 仅写入系统剪贴板
- **粘贴**: 复制数据 → 隐藏窗口 → 模拟快捷键粘贴
- **不操作**: 仅选中该项

**粘贴快捷键模拟**:
- `ctrl_v` - Ctrl+V
- `shift_insert` - Shift+Insert
- 流程: 写入剪贴板 → 隐藏窗口 → 延迟 100ms → 模拟快捷键

### 4.2 键盘导航

| 按键 | 功能 |
|------|------|
| `↑` / `↓` | 选择 Item |
| `Enter` | 执行单击动作 |
| `1-9` | 快速粘贴（配合修饰键） |
| `Esc` | 关闭窗口 |
| `/` / `Ctrl+F` | 聚焦搜索框 |
| `Ctrl+C` | 复制选中项 |
| `Ctrl+V` | 粘贴选中项 |
| `Delete` | 删除选中项 |

**数字键快捷粘贴**:
- 修饰键: `ctrl` / `alt` / `shift` / `ctrl+shift` / `none`
- 默认: `Ctrl+1~9`

### 4.3 上下文菜单

**菜单结构**:
```
┌─ Context Menu ──────────────────────┐
│  [图标] 复制                 Ctrl+C │
│  [图标] 粘贴                 Ctrl+V │
│  ────────────────────────────────── │
│  [图标] 添加到队列                  │
│  ────────────────────────────────── │
│       复制为纯文本                  │ (仅文本/HTML)
│  ────────────────────────────────── │
│  [图标] 打开文件                    │ (图片/文件)
│  [图标] 在文件夹中显示              │ (图片/文件/文件夹)
│  ────────────────────────────────── │
│  [图标] 复制文件路径                │ (文件/文件夹/多文件)
│  ────────────────────────────────── │
│  [图标] ☆ 收藏/取消收藏             │
│  [图标] 🏷️ 管理标签                  │
│  [图标] 删除                  Del   │
└─────────────────────────────────────┘
```

**菜单项可见性矩阵**:
| 菜单项 | text | html | rtf | image | file | folder | files |
|--------|------|------|-----|-------|------|--------|-------|
| 复制 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 粘贴 | ✅ | ✅ | ✅ | ✅ | ❌ | ❌ | ❌ |
| 添加到队列 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 复制为纯文本 | ✅ | ✅ | ❌ | ❌ | ❌ | ❌ | ❌ |
| 打开文件 | ❌ | ❌ | ❌ | ✅ | ✅ | ❌ | ❌ |
| 在文件夹中显示 | ❌ | ❌ | ❌ | ✅ | ✅ | ✅ | ❌ |
| 复制文件路径 | ❌ | ❌ | ❌ | ❌ | ✅ | ✅ | ✅ |
| 管理标签 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 删除 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |

---

## 五、标签系统

### 5.1 功能概述

替代传统的「收藏」功能，支持为一个剪贴板项关联多个标签。

### 5.2 数据结构

```typescript
interface Tag {
  id: string;        // UUID
  name: string;      // 标签名称
  color: string;     // hex 颜色
}
```

### 5.3 标签管理

**添加标签**:
- 右键菜单「管理标签」打开弹窗
- 显示所有已有标签和当前 Item 的标签
- 支持勾选/取消勾选
- 支持创建新标签

**标签管理弹窗**:
```
┌─ Tag Manager ─────────────────────────┐
│  管理标签                        [×]  │
│  ───────────────────────────────────  │
│  当前标签:                            │
│  [工作] [设计] [×]                    │
│  ───────────────────────────────────  │
│  所有标签:                            │
│  ☑ [工作]    ☐ [截图]                 │
│  ☑ [设计]    ☐ [代码]                 │
│  ☐ [链接]    ☐ [灵感]                 │
│  ───────────────────────────────────  │
│  创建新标签:                          │
│  [输入标签名称        ] [创建]        │
└───────────────────────────────────────┘
```

**标签显示**:
- Item 底部最多显示 3 个标签
- 超出显示 `+N`
- 标签颜色基于名称哈希从预设色彩选取
- 标签可点击，点击后自动填入 `@标签名` 到搜索框

**预设标签颜色**:
```typescript
const TAG_COLORS = [
  { bg: '#fff2e8', text: '#fa8c16' },  // 橙色
  { bg: '#e6f7ff', text: '#1890ff' },  // 蓝色
  { bg: '#f6ffed', text: '#52c41a' },  // 绿色
  { bg: '#f9f0ff', text: '#722ed1' },  // 紫色
  { bg: '#fff0f6', text: '#eb2f96' },  // 粉色
  { bg: '#fff7e6', text: '#faad14' },  // 黄色
  { bg: '#f0f5ff', text: '#2f54eb' },  // 深蓝
  { bg: '#fcffe6', text: '#a0d911' },  // 青柠
  { bg: '#e6fffb', text: '#13c2c2' },  // 青色
  { bg: '#fff1f0', text: '#f5222d' },  // 红色
];
```

---

## 六、粘贴队列

### 6.1 功能概述

购物车模式，批量选择多个剪贴板项，一键按顺序粘贴。

### 6.2 工作流程

1. 点击 Item「添加到队列」按钮或右键菜单
2. Item 加入队列面板
3. 可在队列面板中调整顺序或删除
4. 点击「批量粘贴」按顺序粘贴所有内容
5. 粘贴完成后可选清空队列

### 6.3 队列面板

```
┌─ Paste Queue Panel ───────────────────┐
│  粘贴队列 (3)                    [×]  │
│  ───────────────────────────────────  │
│  ┌─ Queue Item 1 ─────────────────┐   │
│  │ [text] 内容预览...        [↑][↓][×]│
│  └─────────────────────────────────┘   │
│  ┌─ Queue Item 2 ─────────────────┐   │
│  │ [image] 图片预览...       [↑][↓][×]│
│  └─────────────────────────────────┘   │
│  ┌─ Queue Item 3 ─────────────────┐   │
│  │ [file] 文件名...          [↑][↓][×]│
│  └─────────────────────────────────┘   │
│  ───────────────────────────────────  │
│  分隔符: [换行 ▼]                     │
│  [清空队列]            [批量粘贴]     │
└───────────────────────────────────────┘
```

### 6.4 分隔符选项

| 选项 | 说明 |
|------|------|
| **换行** | 每个 Item 之间插入换行符 |
| **无** | 直接拼接 |
| **自定义** | 用户输入自定义分隔符 |

### 6.5 批量粘贴流程

1. 验证队列不为空
2. 按顺序处理每个 Item:
   - 将内容写入系统剪贴板
   - 模拟粘贴快捷键
   - 如果设置了分隔符，先粘贴分隔符
   - 延迟 200ms 后处理下一个
3. 粘贴完成后可选清空队列

---

## 七、抽屉编辑器

### 7.1 功能概述

从右侧滑出，用于预览和编辑剪贴板项的详细内容。

### 7.2 触发方式

- 点击 Item「详情」按钮（Hover 显示）
- 右键菜单「编辑」（仅文本类型）

### 7.3 类型特定视图

#### 文本类型 (text/html/rtf)

```
┌─ Drawer Editor ─────────────────────────────┐
│  文本详情                              [×]  │
│  ─────────────────────────────────────────  │
│  ┌─ Editor ─────────────────────────────┐   │
│  │  [可编辑的文本区域]                   │   │
│  └────────────────────────────────────────┘   │
│  字符数: 100 | 单词数: 20 | 行数: 5 | 大小: 1KB  │
│  ─────────────────────────────────────────  │
│  [复制] [粘贴] [保存为新项]                 │
└─────────────────────────────────────────────┘
```

**功能**:
- 可编辑的文本区域
- 实时统计: 字符数、单词数、行数、大小
- 操作按钮: 复制、粘贴、保存为新项

#### 图片类型

```
┌─ Drawer Editor ─────────────────────────────┐
│  图片预览                              [×]  │
│  ─────────────────────────────────────────  │
│  ┌─ Image Preview ──────────────────────┐   │
│  │     [大图预览，自适应宽度]            │   │
│  └────────────────────────────────────────┘   │
│  尺寸: 1920x1080 | 格式: PNG | 大小: 2.5MB  │
│  ─────────────────────────────────────────  │
│  [复制] [粘贴]                              │
└─────────────────────────────────────────────┘
```

**功能**:
- 大图预览（自适应宽度）
- 图片信息: 尺寸、格式、文件大小

#### 文件/文件夹类型

```
┌─ Drawer Editor ─────────────────────────────┐
│  文件详情                              [×]  │
│  ─────────────────────────────────────────  │
│  ┌─ File Info ───────────────────────────┐   │
│  │  [文件图标]                            │   │
│  │  文件名: document.pdf                  │   │
│  │  大小: 2.5MB                           │   │
│  │  路径: C:\Users\...\document.pdf       │   │
│  └────────────────────────────────────────┘   │
│  [打开文件] [在文件夹中显示] [复制路径]     │
│  [复制] [粘贴]                              │
└─────────────────────────────────────────────┘
```

#### 多文件类型

```
┌─ Drawer Editor ─────────────────────────────┐
│  多文件详情 (5个文件)                  [×]  │
│  ─────────────────────────────────────────  │
│  ┌─ Files List ──────────────────────────┐   │
│  │  [图标] file1.jpg                     │   │
│  │  [图标] file2.png                     │   │
│  │  [图标] file3.txt                     │   │
│  └────────────────────────────────────────┘   │
│  [复制所有路径] [粘贴]                      │
└─────────────────────────────────────────────┘
```

### 7.4 复制文件路径格式

- 多文件路径使用换行符 (`\n`) 分隔
- 路径列表末尾不添加额外换行符

---

## 八、设置面板

### 8.1 窗口设计

- **尺寸**: 600x700，可调整大小
- **标题**: "Paste Library - 设置"
- **布局**: 左侧导航 (220px) + 右侧内容区

### 8.2 导航结构

| 导航项 | 内容分组 |
|--------|----------|
| **剪贴板** | 窗口设置、搜索设置、内容设置 |
| **历史记录** | 最大条数、自动清理 |
| **通用设置** | 开机自启、局域网同步 |
| **快捷键** | 唤醒快捷键、数字键修饰键 |
| **数据备份** | 导入导出、存储路径 |
| **关于** | 应用信息、打开剪贴板按钮 |

### 8.3 设置项详细规格

#### 剪贴板设置

**窗口设置**:

| 设置项 | 类型 | 默认值 | 选项 |
|--------|------|--------|------|
| `window_position` | 选择 | `remember` | `remember`/`center`/`cursor` |
| `smart_activate` | 开关 | `true` | true/false |
| `focus_search_on_activate` | 开关 | `false` | true/false |

**搜索设置**:

| 设置项 | 类型 | 默认值 | 选项 |
|--------|------|--------|------|
| `search_position` | 选择 | `top` | `top`/`bottom` |

**内容设置**:

| 设置项 | 类型 | 默认值 | 选项 |
|--------|------|--------|------|
| `click_action` | 选择 | `copy` | `copy`/`paste`/`none` |
| `double_click_action` | 选择 | `paste` | `copy`/`paste`/`none` |
| `paste_shortcut` | 选择 | `ctrl_v` | `ctrl_v`/`shift_insert` |
| `hide_window_after_copy` | 开关 | `false` | true/false |
| `copy_as_plain_text` | 开关 | `false` | true/false |
| `confirm_delete` | 开关 | `true` | true/false |
| `auto_sort` | 开关 | `true` | true/false |

#### 历史记录设置

| 设置项 | 类型 | 默认值 | 范围 |
|--------|------|--------|------|
| `max_history_count` | 数字 | `1000` | 100-10000 |
| `auto_cleanup_days` | 选择 | `0` | `0`/`7`/`30`/`90` |

#### 通用设置

| 设置项 | 类型 | 默认值 |
|--------|------|--------|
| `auto_start` | 开关 | `false` |
| `lan_sync_enabled` | 开关 | `false` |

#### 快捷键设置

| 设置项 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| `hotkey` | 按键录制 | `Alt+V` | 唤醒快捷键 |
| `number_key_shortcut` | 选择 | `ctrl` | 数字键 1-9 修饰键 |

**按键录制**:
- 支持修饰键: Ctrl, Alt, Shift, Win
- 支持字母键 A-Z, 数字键 0-9, F键 F1-F12
- 支持特殊键: Space, Enter, Escape, Tab, 方向键
- 修改后需重启应用生效

**数字键修饰键选项**:
- `none` - 直接按 1-9
- `ctrl` - Ctrl+1~9
- `alt` - Alt+1~9
- `shift` - Shift+1~9
- `ctrl+shift` - Ctrl+Shift+1~9

#### 数据备份

**存储路径显示**:
- 数据存储路径（可复制、可打开文件夹）
- 缩略图路径（可打开文件夹）
- 日志路径（仅显示）

**导入导出**:
- 导出数据: JSON 格式
- 导入数据: 从 JSON 合并

---

## 九、系统托盘

### 9.1 托盘图标

- 应用启动后常驻系统托盘
- 图标: 应用 Logo（浅色/深色适配）
- tooltip: "Paste Library"

### 9.2 托盘菜单

```
┌─ Tray Menu ────────────────┐
│  打开设置                  │
│  显示剪贴板        Alt+V   │
│  ───────────────────────── │
│  退出                      │
└────────────────────────────┘
```

### 9.3 托盘交互

- **左键双击**: 打开设置窗口
- **右键单击**: 显示托盘菜单
- **中键点击**（可选）: 显示/隐藏剪贴板窗口

### 9.4 关闭行为

- 点击剪贴板窗口关闭按钮 → 隐藏窗口（非退出）
- 点击设置窗口关闭按钮 → 隐藏窗口（非退出）
- 完全退出需通过托盘菜单「退出」

---

## 十、窗口管理

### 10.1 剪贴板窗口

**窗口属性**:
- 无边框 (`decorations: false`)
- 不在任务栏显示 (`skip_taskbar: true`)
- 置顶显示 (`always_on_top: true`)
- 尺寸: 800x600（可调整）
- 最小尺寸: 400x300

**显示/隐藏**:
- 快捷键唤醒: `Alt+V`（可配置）
- 显示时根据 `window_position` 设置决定位置
- 隐藏时记住位置（如果 `window_position: remember`）

**自动隐藏**:
- 窗口失焦时自动隐藏
- 延迟 200ms 后执行

### 10.2 设置窗口

**窗口属性**:
- 正常窗口 (`decorations: true`)
- 标题: "Paste Library - 设置"
- 尺寸: 600x700
- 居中显示

### 10.3 首次运行检测

- 检查设置文件是否存在
- 如果不存在，显示设置窗口（而非剪贴板窗口）
- 引导用户配置基本设置

---

## 十一、智能功能

### 11.1 内部/外部复制区分

**目的**: 区分应用内复制和系统剪贴板复制，避免重复记录

**实现**:
- 应用内复制时设置标记 `is_internal_copy: true`
- 监听器检查标记:
  - `true`: 内部复制，更新现有项的时间戳但不改变位置
  - `false`: 系统复制，新增记录或置顶现有项

### 11.2 智能激活

**触发条件**:
- 窗口显示时间 - 上次复制时间 < 5 秒

**执行操作**:
1. 清空搜索框
2. 滚动到列表顶部
3. 切换到「全部」标签页
4. 聚焦搜索框（如果 `focus_search_on_activate: true`）

### 11.3 搜索自动回顶

- 搜索文本变化时自动滚动到列表顶部
- 确保用户看到最新的搜索结果

### 11.4 图片加载重试

- 缩略图加载失败时自动重试
- 最多重试 5 次
- 显示加载状态占位符

---

## 十二、数据备份

### 12.1 导出数据

- 格式: JSON
- 包含: 所有剪贴板记录、设置、标签
- 路径: 用户选择保存位置

### 12.2 导入数据

- 支持导入 JSON 格式的备份文件
- 合并策略:
  - 已存在的记录: 保留较新的版本
  - 新记录: 直接添加
  - 标签: 合并标签列表

### 12.3 存储路径显示

| 路径 | 说明 | 操作 |
|------|------|------|
| 数据存储路径 | SQLite 数据库位置 | 复制路径、打开文件夹 |
| 缩略图路径 | 图片缩略图存储位置 | 打开文件夹 |
| 日志路径 | 应用日志文件位置 | 打开文件夹 |

---

## 相关文档

- [01_OVERVIEW.md](./01_OVERVIEW.md) - 项目概述
- [03_ARCHITECTURE.md](./03_ARCHITECTURE.md) - 技术架构
- [04_UI_SPEC.md](./04_UI_SPEC.md) - UI 设计规范
- [05_DATA_MODEL.md](./05_DATA_MODEL.md) - 数据模型
- [06_IMPLEMENTATION.md](./06_IMPLEMENTATION.md) - 实施计划
