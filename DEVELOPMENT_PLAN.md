# Paste Library - 开发计划

## 项目概述

现代化的剪贴板管理工具，实时监听系统剪贴板，保存历史记录，支持快速查询和管理。

**技术栈**: Tauri v2 + Vue 3 + TypeScript

---

## 开发阶段

### 阶段 1: 基础设施搭建 ✅ COMPLETE
- [x] 安装 tauri-plugin-clipboard-x 依赖
- [x] Rust 后端初始化
- [x] 前端项目结构搭建
- [x] 数据存储方案确定 (SQLite)

### 阶段 2: 剪贴板监听与数据管理 ✅ COMPLETE
- [x] 剪贴板实时监听
- [x] 数据模型设计
- [x] Rust 后端 API

### 阶段 3: 用户界面 ✅ COMPLETE
- [x] 主窗口设计
- [x] 剪贴板历史列表
- [x] 交互功能
- [x] 窗口控制

### 阶段 4: 高级功能 ✅ COMPLETE
- [x] 搜索与过滤
- [x] 设置面板
- [x] 图片/文件类型支持
- [x] 右键上下文菜单
- [x] 收藏功能（已迁移到标签系统）
- [x] 系统托盘集成
- [x] 数据导出与备份

### 阶段 5: Item 重构与体验优化 ✅ COMPLETE

### 阶段 5.5: 设置功能实现 ⏳ IN PROGRESS
**详情见 [SETTINGS_IMPLEMENTATION.md](docs/SETTINGS_IMPLEMENTATION.md)**

设置面板UI已完成并可以保存数据，但前端代码没有实际使用这些设置。本阶段将实现所有"存而不用"的设置功能。

**2026-02-07 需求变更**: 移除7项不需要的功能，新增智能激活功能

**实现进度:** 27% (4/15项已完整实现)

**🔴 P0 - 核心体验设置（4项）**
- [x] **smart_activate** - 智能激活 ⭐ **已实现**
  - 如果激活时间与上次复制间隔<5秒，自动回到顶部、切换全部、聚焦搜索
  - 实现文件: ClipboardList.vue, useClipboard.ts
- [ ] auto_paste - 自动粘贴行为（单击/双击）
- [ ] window_position - 窗口位置（记住/居中/跟随光标）
- [ ] search_position - 搜索框位置（顶部/底部）

**🟡 P1 - 增强体验设置（4项）**
- [ ] copy_sound - 复制音效
- [ ] confirm_delete - 删除确认对话框
- [ ] copy_as_plain_text - 复制为纯文本
- [ ] auto_sort - 自动排序（重复内容置顶）

**🟢 P2 - 进阶功能设置（3项）**
- [ ] auto_start - 开机自启
- [ ] paste_as_plain_text - 粘贴为纯文本
- [ ] image_ocr - 图片OCR识别

**✅ 已实现设置（3项）**
- [x] hotkey - 唤醒快捷键（需重启生效）
- [x] max_history_count - 最大历史记录数（后端自动）
- [x] auto_cleanup_days - 自动清理天数（后端自动）

**❌ 已移除设置（7项）**
- ~~auto_favorite~~ - 自动收藏
- ~~操作按钮~~ - 操作按钮自定义
- ~~clear_search_on_activate~~ - 自动清除搜索
- ~~scroll_to_top_on_activate~~ - 激活时回到顶部（合并到智能激活）
- ~~switch_to_all_on_activate~~ - 激活时切换至全部分组（合并到智能激活）
- ~~blacklist_apps~~ - 应用黑名单
- ~~window_width/window_height~~ - 窗口尺寸

### 阶段 6: 测试与优化 📋 PLANNED
**Phase 1: Item 基础重构（Foundation）**
- [x] 可变高度 Item 设计（文本最多3行、图片自适应高度）
- [x] 信息展示简化（统计信息移至抽屉）
- [x] 标签系统替代收藏（数据模型 + UI）
- [x] Hover 快捷操作按钮（队列/复制/标签/删除）

**Phase 2: 核心交互增强（Core）**
- [x] 键盘导航系统（↑↓、Enter、数字键1-9、Esc）
- [x] 粘贴队列（购物车模式、批量粘贴）
- [x] 抽屉式编辑器（文本编辑、图片预览）

**Phase 3: 高级功能（Advanced）**
- [x] 跨应用拖拽
- [x] 模糊搜索（拼音、首字母、容错、标签搜索）
- [x] 图片文件缩略图显示（使用 convertFileSrc）
- [ ] ItemList虚拟滚动

### 阶段 6: 测试与优化 📋 PLANNED
- [ ] 功能测试
- [ ] 性能优化
- [ ] UI/UX 优化

### 阶段 7: 构建与发布 📋 PLANNED
- [ ] 打包构建
- [ ] 版本管理
- [ ] 发布

---

## 当前进度

| 阶段 | 完成度 |
|------|--------|
| 基础设施 | 100% ✅ |
| 监听与存储 | 100% ✅ |
| 用户界面 | 100% ✅ |
| 高级功能 | 100% ✅ |
| Item 重构与体验优化 | 100% ✅ |
| 设置功能实现 | 20% ⏳ |
| 测试与优化 | 0% 📋 |
| 构建与发布 | 0% 📋 |

**总体进度**: ~85%

---

## 已完成功能 ✅

### 核心功能 (P0)
- [x] 图片类型监听与显示
- [x] 文件/文件夹类型监听与显示
- [x] 左键/双击/右键交互
- [x] 右键上下文菜单 (ContextMenu组件)
- [x] 收藏/取消收藏功能（即将被标签系统替代）
- [x] 系统托盘集成

### 类型系统
- [x] TypeScript 类型定义 (ClipboardContentType, ClipboardMetadata)
- [x] Rust 模型同步 (models.rs)
- [x] 数据库 schema 迁移 (metadata, file_paths, thumbnail_path, is_favorite)

### 交互功能
- [x] 单击复制到剪贴板
- [x] 双击复制并粘贴
- [x] 右键显示上下文菜单
- [x] 打开文件 (open_file)
- [x] 在文件夹中显示 (show_in_folder)

### 重构计划 (开发中)
详见 [FEATURE_IMPLEMENTATION_CHECKLIST.md](docs/FEATURE_IMPLEMENTATION_CHECKLIST.md)
- 可变高度 Item 设计（文本3行、图片3行）
- 标签系统替代收藏（多标签、颜色、管理面板）
- Hover 快捷按钮（复制/标签/删除）
- 键盘导航（↑↓、Enter、1-9数字键）
- 粘贴队列（购物车批量粘贴）
- 抽屉式编辑器（文本编辑、图片预览）
- 跨应用拖拽
- 模糊搜索（拼音、首字母、容错）
- 搜索时，弹出搜索建议组件（显示所有标签，点击标签后加上关键字，类似 github pr 搜索一样 is:pr is:open ，我们的搜索词变成 tag:工作 tag:灵感 这种格式）
- 图片文件缩略图

---

## 待开发功能清单

### ✅ 已完成功能

**Phase 1: Item 基础重构**
- [x] 可变高度 Item 设计
  - 文本类型最多显示3行
  - 图片类型使用3行高度缩略图
  - 图片文件直接显示缩略图
- [x] 信息展示简化（统计信息移至抽屉）
- [x] 标签系统替代收藏功能
  - 移除 `is_favorite` 字段
  - 新增 `tags: string[]` 支持多标签
  - 标签管理面板
  - 数据迁移
- [x] Hover 快捷操作按钮
  - 详情 / 队列 / 复制 / 标签 / 删除 五个按钮

**Phase 2: 核心交互增强**
- [x] 键盘导航系统
  - ↑/↓ 导航 item
  - Enter 粘贴选中项
  - 1-9 数字键快速粘贴
  - Esc 关闭窗口
- [x] 粘贴队列（购物车模式）
  - 添加到队列
  - 选择分隔符（换行/无/自定义）
  - 一键批量粘贴
- [x] 抽屉式预览与编辑器
  - 文本：可编辑，显示统计信息
  - 图片：大图预览

**Phase 3: 高级功能**
- [x] 跨应用拖拽
- [x] 模糊搜索（拼音、首字母、容错）
- [x] 图片文件缩略图显示（使用 convertFileSrc）
- [ ] ItemList虚拟滚动

### 中优先级 (P1)
- [x] 数据备份导入导出
- [x] 存储路径显示
- [x] 设置面板页面完善

### 低优先级 (P2)
- [ ] 多语言支持
- [ ] 主题切换
- [ ] 缩略图懒加载
- [ ] 性能优化

### 设置功能实现 ⏳ (详见 docs/SETTINGS_IMPLEMENTATION.md)

**2026-02-07 需求变更**: 移除7项不需要的功能，新增智能激活

**P0 - 核心体验设置（必须实现）**
- [x] **smart_activate** - 智能激活 ⭐ **已实现** (2026-02-07)
  - 如果激活时间与上次复制间隔<5秒，自动回到顶部、切换全部、聚焦搜索
  - ClipboardList.vue 监听 `tauri://focus` 窗口事件
  - useClipboard.ts 记录 lastCopyTime
- [ ] **auto_paste** - 自动粘贴行为（单击/双击/关闭）
  - 当前只读取了设置值，未实现粘贴逻辑
  - 需要模拟键盘粘贴操作
- [ ] **window_position** - 窗口位置（remember/center/cursor）
  - 后端 window_manager.rs 创建窗口时使用
  - 需要实现记住位置功能
- [ ] **search_position** - 搜索框位置（top/bottom）
  - ClipboardList.vue 条件渲染搜索栏位置

**P1 - 增强体验设置**
- [ ] **copy_sound** - 复制音效
  - 需要准备音效文件资源
  - restoreToClipboard 时播放音效
- [ ] **confirm_delete** - 删除确认对话框
  - 删除操作前显示 confirm 弹窗
- [ ] **copy_as_plain_text** - 复制为纯文本
  - HTML/RTF 类型复制时去除标签
- [ ] **auto_sort** - 自动排序
  - 重复内容复制时置顶（后端逻辑）

**P2 - 进阶功能设置**
- [ ] **auto_start** - 开机自启
  - 需要系统级配置或Tauri API
- [ ] **paste_as_plain_text** - 粘贴为纯文本
  - 模拟粘贴时去除富文本格式
- [ ] **image_ocr** - 图片OCR识别
  - 需要集成 OCR 库（如 tesseract）

**已实现设置（3项）**
- [x] **hotkey** - 唤醒快捷键（Alt+V）
- [x] **max_history_count** - 最大历史记录数（后端自动限制）
- [x] **auto_cleanup_days** - 自动清理天数（后端自动清理）

**❌ 已移除设置（7项）**
- ~~auto_favorite~~ - 自动收藏（不需要）
- ~~操作按钮~~ - 操作按钮自定义（不需要）
- ~~clear_search_on_activate~~ - 激活时清除搜索（不需要）
- ~~scroll_to_top_on_activate~~ - 激活时回到顶部（合并到智能激活）
- ~~switch_to_all_on_activate~~ - 激活时切换至全部分组（合并到智能激活）
- ~~blacklist_apps~~ - 应用黑名单（不需要）
- ~~window_width/window_height~~ - 窗口尺寸（不需要）

---

## 更新记录
- 2026-02-05: 完成基础设施、剪贴板监听、卡片式UI
- 2026-02-06: 实现全局快捷键(Alt+V)、窗口失焦自动隐藏、设置面板UI
- 2026-02-06: 完成图片/文件类型支持、右键菜单、收藏功能、交互增强
- 2026-02-06: 完成系统托盘集成（双击打开设置、右键菜单）
- 2026-02-06: 确定 Item 重构方案（可变高度、标签系统、Hover按钮、键盘导航、粘贴队列、抽屉编辑器）
- 2026-02-07: **完成 Phase 5** - Item 重构与体验优化全部完成
  - ✅ 可变高度 Item 设计（文本3行自适应、图片自适应）
  - ✅ 标签系统替代收藏（数据模型 + UI）
  - ✅ Hover 快捷操作按钮（详情/队列/复制/标签/删除）
  - ✅ 键盘导航系统（↑/↓、Enter、1-9、Esc）
  - ✅ 粘贴队列（购物车模式、批量粘贴）
  - ✅ 抽屉式编辑器（文本编辑、图片预览）
  - ✅ 图片加载修复（使用 convertFileSrc + CSP 配置）
  - ✅ Item 交互优化：点击复制/粘贴（设置控制），详情按钮打开抽屉
- 2026-02-07: **完成所有 P1 优先级任务**
  - ✅ 数据备份导入导出（JSON 格式，支持导入/导出）
  - ✅ 存储路径显示（数据/日志路径 + 复制/打开功能）
  - ✅ 设置面板完善（历史记录删除按钮）
  - ✅ 跨应用拖拽（支持文本/图片/文件拖拽到其他应用）
  - ✅ 模糊搜索（拼音、首字母、容错、标签搜索）
- 2026-02-07: **发现设置功能实现缺失问题**
  - 设置面板UI完成但功能未实现（20%完成度）
  - 创建 SETTINGS_IMPLEMENTATION.md 详细规划
  - 20项设置中仅4项完整实现，16项存而不用
- 2026-02-07: **完成智能激活功能**
  - 移除7项不需要的设置（自动收藏、操作按钮、自动清除、应用黑名单、窗口尺寸等）
  - 新增 smart_activate 智能激活功能
  - 如果激活时间与上次复制间隔<5秒，自动回到顶部、切换全部、聚焦搜索
  - 更新类型定义、Rust模型、数据库、设置面板UI
  - 实现进度: 27% (4/15)
