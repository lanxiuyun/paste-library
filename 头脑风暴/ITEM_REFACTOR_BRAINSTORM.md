# 剪贴板 Item 重构头脑风暴

> 讨论日期: 2026-02-06  
> 背景: 当前 ClipboardItem 采用固定高度设计，收藏功能使用频率可能不高，考虑转向更灵活的标签系统

---

## 用户的想法

### 1. 可变高度 Item 设计

**文本类型**
- 当前: 单行显示，超出部分截断
- 提议: 最多显示三行，超出显示省略号
- 优势: 可以预览更多内容，减少点击次数

**图片类型**
- 当前: 小缩略图 (48x36px) + 尺寸信息
- 提议: 按照三行文本的高度显示缩略图
- 优势: 图片更直观，视觉体验更好

**文件类型（图片文件）**
- 当前: 📄 图标 + 文件名
- 提议: 直接显示图片缩略图（如果可以读取）
- 优势: 快速识别图片文件内容

### 2. 标签系统替代收藏

**当前收藏系统**
- 每个 item 有一个 `is_favorite` boolean 字段
- UI 显示 ⭐ 图标
- 可以筛选查看收藏

**提议的标签系统**
- 给每个 item 打多个标签（如: "工作", "灵感", "待办"）
- 搜索时可以搜索标签
- 比单纯的收藏更灵活

### 3. Hover 快捷操作按钮

**当前交互**
- 需要右键打开菜单才能操作

**提议**
- Hover 时右上角显示操作按钮（复制、删除、打标签等）
- 减少点击次数，提高效率

---

## 我的分析和建议

### 关于可变高度设计

**优点**
1. 文本预览更充分，三行可以显示约 60-80 个汉字
2. 图片显示更大，视觉体验提升明显
3. 整体界面更有层次感

**需要考虑的问题**

| 问题 | 影响 | 建议方案 |
|------|------|----------|
| 列表滚动性能 | 高度不固定可能影响虚拟滚动 | 使用固定高度模式，但每种类型有标准高度 |
| 视觉一致性 | 参差不齐的 item 可能显乱 | 按类型分类显示，同类型内高度一致 |
| 键盘导航 | 上下箭头导航时位置计算复杂 | 保留固定高度，或者为键盘导航做特殊处理 |

**推荐方案**
```
选项 A: 完全可变高度（用户提议）
- 文本: 最多 3 行 (约 72px)
- 图片: 3 行高度 (约 72px)
- 文件: 固定 1 行 (约 36px)

选项 B: 类型内固定高度（我的建议）
- 文本类型: 固定 3 行高度
- 图片类型: 固定 3 行高度  
- 文件类型: 固定 1 行高度
- 好处: 同类型内高度一致，不同类有区分度
```

### 关于标签系统

**这是一个很好的升级方向！**

**优势分析**
1. **更灵活的分类** - 一个 item 可以有多个标签（"工作"+"紧急"）
2. **搜索增强** - 搜索 "设计" 可以找到所有相关标签的 item
3. **颜色编码** - 不同标签可以用不同颜色，视觉识别度高
4. **可扩展性** - 未来可以做标签云、智能标签建议

**实现方案对比**

| 方案 | 数据结构 | 复杂度 | 优缺点 |
|------|----------|--------|--------|
| 简单标签 | `tags: string[]` | 低 | 简单，但无法管理标签元数据 |
| 标签表关联 | 多对多关系表 | 中 | 支持标签管理、颜色、统计 |
| 混合方案 | 存储字符串+内存索引 | 低 | 简单实现，后续可升级 |

**推荐: 方案 3（混合方案）**
```rust
// 在 ClipboardItem 中
pub tags: Option<Vec<String>>, // ["工作", "灵感"]

// 前端维护标签元数据
type TagMeta = {
  name: string;
  color: string;
  count: number; // 使用该标签的 item 数
}
```

**UI 展示建议**
```
[item 内容]
[标签栏] [工作] [重要]        [时间]
```

### 关于 Hover 快捷操作

**完全赞同！这是提升效率的好设计**

**建议的按钮布局**
```
┌─────────────────────────────────────┐
│ [内容区域...]        [复制] [标签] [×] │
└─────────────────────────────────────┘
```

**按钮功能**
1. **复制** - 一键复制到剪贴板
2. **标签** - 快速添加/编辑标签（弹出小菜单）
3. **删除** - 删除 item（带确认或撤销）

**交互细节**
- Hover 时按钮淡入（150ms 过渡）
- 按钮使用图标而非文字，节省空间
- 在触摸设备上改为长按显示

---

## 完整重构方案

### 数据模型变更

```rust
// models.rs
pub struct ClipboardItem {
    // ... 现有字段 ...
    pub is_favorite: bool,  // ← 移除
    pub tags: Option<Vec<String>>, // ← 新增
}

pub struct TagMeta {
    pub name: String,
    pub color: String, // #ff5722
    pub created_at: DateTime<Utc>,
}
```

```typescript
// types/index.ts
export interface ClipboardItem {
  // ... 现有字段 ...
  is_favorite?: boolean; // ← 移除
  tags?: string[];       // ← 新增
}

export interface Tag {
  name: string;
  color: string;
  count: number;
}
```

### 数据库迁移

```sql
-- 新增标签表
CREATE TABLE tags (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT UNIQUE NOT NULL,
    color TEXT DEFAULT '#1890ff',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- item 标签关联表
CREATE TABLE item_tags (
    item_id INTEGER REFERENCES clipboard_history(id) ON DELETE CASCADE,
    tag_name TEXT NOT NULL,
    PRIMARY KEY (item_id, tag_name)
);

-- 迁移：将收藏转换为标签
INSERT INTO tags (name, color) VALUES ('收藏', '#faad14');
INSERT INTO item_tags (item_id, tag_name)
SELECT id, '收藏' FROM clipboard_history WHERE is_favorite = 1;

-- 移除 is_favorite 字段（可选，视情况而定）
```

### UI 组件重构

#### ClipboardItem.vue 变更

```vue
<template>
  <div class="clipboard-item" :class="[item.content_type, { 'is-hovered': isHovered }]">
    <!-- 内容区域 -->
    <div class="content-wrapper">
      <!-- 文本类型：最多 3 行 -->
      <template v-if="item.content_type === 'text' || item.content_type === 'html'">
        <p class="content-text multi-line">{{ contentPreview }}</p>
      </template>
      
      <!-- 图片类型：更大缩略图 -->
      <template v-else-if="item.content_type === 'image'">
        <div class="image-preview large">
          <img :src="thumbnailUrl" />
        </div>
      </template>
      
      <!-- 文件类型：如果是图片则显示缩略图 -->
      <template v-else-if="item.content_type === 'file'">
        <div v-if="isImageFile" class="image-preview">
          <img :src="fileThumbnailUrl" />
        </div>
        <div v-else class="file-preview">
          <span class="file-icon">📄</span>
          <span class="file-name">{{ fileName }}</span>
        </div>
      </template>
    </div>
    
    <!-- 底部栏：标签 + 时间 + 操作按钮 -->
    <div class="item-footer">
      <div class="tags-bar">
        <span v-for="tag in item.tags" :key="tag" class="tag" :style="getTagStyle(tag)">
          {{ tag }}
        </span>
      </div>
      <span class="time">{{ formattedTime }}</span>
    </div>
    
    <!-- Hover 快捷操作 -->
    <div v-show="isHovered" class="quick-actions">
      <button class="action-btn" @click.stop="handleCopy" title="复制">
        <CopyIcon />
      </button>
      <button class="action-btn" @click.stop="showTagMenu" title="标签">
        <TagIcon />
      </button>
      <button class="action-btn danger" @click.stop="handleDelete" title="删除">
        <DeleteIcon />
      </button>
    </div>
  </div>
</template>
```

#### 样式设计

```scss
.clipboard-item {
  // 根据类型有不同的最小高度
  &.text, &.html { min-height: 80px; }
  &.image { min-height: 100px; }
  &.file { min-height: 60px; }
  
  .content-text {
    display: -webkit-box;
    -webkit-line-clamp: 3;  // 最多 3 行
    -webkit-box-orient: vertical;
    overflow: hidden;
    line-height: 1.5;
  }
  
  .image-preview.large img {
    max-height: 72px;  // 约 3 行文本高度
    border-radius: 4px;
  }
  
  .quick-actions {
    position: absolute;
    top: 8px;
    right: 8px;
    display: flex;
    gap: 4px;
    opacity: 0;
    transition: opacity 0.15s ease;
  }
  
  &.is-hovered .quick-actions {
    opacity: 1;
  }
}
```

### 新增功能

#### 1. 标签管理器（TagManager）
- 添加标签
- 删除标签
- 修改标签颜色
- 查看标签统计

#### 2. 标签搜索
```rust
// 搜索命令支持标签
#[tauri::command]
fn search_clipboard_history(
    query: String,
    tag_filter: Option<Vec<String>>, // ← 新增
) -> Result<Vec<ClipboardItem>, String>
```

#### 3. 标签云/快速筛选
- 显示常用标签
- 点击标签快速筛选

---

## 实现优先级建议

### Phase 1: UI 重构（低风险）
- [ ] 修改 ClipboardItem 组件样式（可变高度）
- [ ] 添加 Hover 快捷操作按钮
- [ ] 测试响应式表现

### Phase 2: 数据迁移（中风险）
- [ ] 添加 `tags` 字段到数据模型
- [ ] 数据库迁移脚本
- [ ] 将收藏数据迁移到标签

### Phase 3: 标签功能（高风险）
- [ ] 标签管理 UI
- [ ] 搜索支持标签过滤
- [ ] 标签快捷筛选栏

### Phase 4: 图片文件缩略图（可选）
- [ ] 检测文件类型是否为图片
- [ ] 生成文件缩略图
- [ ] 显示优化

---

## 讨论问题

1. **收藏是否完全废弃？** 还是保留"收藏"作为一个默认标签？
收藏完全废弃

2. **标签颜色** - 是用户自定义，还是系统预设一套颜色？
系统预设一套颜色，并且需要一个标签面板，用户可以添加和删除标签

3. **Hover 按钮** - 是否需要支持自定义显示哪些按钮？
显示复制，标签，删除按钮

4. **可变高度** - 是否保留选项让用户切换回固定高度？
不用

5. **图片文件缩略图** - 是否所有图片文件都生成缩略图？这会增加存储和性能开销。
所有图片文件都生成缩略图，我们采用虚拟滚动啦，然后还需要上下按键能导航当前的item，enter直接执行粘贴动作。

---

## 我的推荐

**先做 Phase 1 + Phase 2 的核心部分：**
1. 实现可变高度 Item（保持简洁，先只做文本）
2. 添加 Hover 快捷操作按钮
3. 用标签替换收藏，但保留"收藏"作为默认标签
4. 搜索支持标签过滤

**暂时不做：**
- 图片文件缩略图（复杂度较高）
- 完整的标签管理系统（可以先只做添加/删除）

这样可以在保证体验提升的同时，控制开发复杂度。

---

# 🧠 持续头脑风暴区域

> 这里记录各种提升用户体验的功能想法，不急着实现，先头脑风暴收集灵感

**用户确认的高优先级功能（2026-02-06）：**
- ✅ 键盘导航 + 数字快捷键 + 自定义快捷键
- ✅ 粘贴队列（购物车式批量粘贴）
- ✅ 悬停预览 + 抽屉编辑
- ✅ 跨应用拖拽
- ✅ 模糊搜索

---

## 💡 功能想法列表

### 1. 智能搜索增强 🔍

**模糊搜索**
- 拼音搜索：搜索 "gz" 匹配 "工作"
- 首字母搜索：搜索 "sj" 匹配 "设计"
- 容错搜索："cilp" 也能匹配 "clip"

**搜索体验**
- 搜索结果高亮显示匹配关键词
- 搜索历史记录（最近搜索过的关键词）
- 搜索建议（根据输入提示常用标签/内容）

**高级筛选**
- 按时间范围筛选（今天/本周/本月/自定义）
- 按内容类型筛选（可多选：文本+图片）
- 按来源应用筛选（从哪个 App 复制的）

---

### 2. 快捷操作增强 ⚡

**键盘导航**
- `↑/↓` - 上下导航 item
- `Enter` - 粘贴当前选中项
- `Space` - 预览内容（不关闭窗口）
- `Delete` - 删除当前项
- `Ctrl/Cmd + Enter` - 复制但不粘贴
- `Esc` - 关闭窗口

**数字快捷键**
- `1-9` - 快速粘贴第 1-9 个 item
- 在 item 上显示数字角标

**自定义快捷键**
- 允许用户自定义所有快捷键
- 快捷键冲突检测

---

### 3. 预览功能 👁️

**悬停预览**
- 鼠标悬停 500ms 后显示浮动预览框
- 图片：显示完整大图
- 文本：显示完整内容（带滚动）
- 代码：语法高亮显示

**抽屉式编辑器** ⭐ 用户高优先级
- 点击文本 item → 从右侧滑出编辑抽屉
- 抽屉功能：
  - 显示完整文本内容
  - 可直接编辑修改
  - 编辑后：复制 / 直接粘贴 / 保存为新 item
  - 支持搜索/替换
- 图片 item → 抽屉显示完整大图
  - 支持缩放、拖拽查看
  - 显示图片信息（尺寸、大小、格式）

**快速预览面板**
- 按空格键展开侧边预览面板
- 显示选中 item 的完整信息
- 支持复制部分内容

**图片预览增强**
- 图片缩放查看
- 图片信息（EXIF：相机型号、拍摄时间等）
- 图片直方图（给设计师用）

---

### 4. 组织管理 📁

**智能分组**
- 按时间自动分组（今天、昨天、本周、更早）
- 按类型分组（文本、图片、文件）
- 按来源应用分组

**文件夹系统**
- 创建自定义文件夹（如"项目A素材"）
- 拖拽 item 到文件夹
- 文件夹可以嵌套

**时间线视图**
- 类似 Mac 时间线的横向滚动视图
- 按时间节点浏览历史
- 适合找"昨天下午复制的那个东西"

**智能排序**
- 最近使用（默认）
- 使用频率（最常用的排在前面）
- 内容大小（大文件优先/小文件优先）

---

### 5. 数据智能 🤖

**智能去重**
- 自动检测相似内容
- "这个内容和你 3 天前复制的 90% 相似，要合并吗？"
- 链接去重（相同 URL 只保留最新的）

**重复内容检测**
- 定期扫描找出重复项
- 一键清理重复内容
- 显示重复次数统计

**使用分析**
- 统计最常复制的应用
- 统计复制高峰期时段
- 统计各类内容占比（饼图）

**智能标签建议**
- 根据内容自动建议标签
- "这段代码像 Python，建议标签：Python"
- "这是公司邮箱，建议标签：工作"

---

### 6. 工作流优化 🚀

**批量操作**
- 多选模式（Ctrl/Cmd + 点击）
- 批量复制（合并粘贴）
- 批量删除
- 批量打标签

**合并粘贴**
- 选择多个 item，按特定格式合并粘贴
- 示例：选3段文本 → 粘贴时用换行符连接
- 自定义合并模板

**粘贴队列（购物车模式）** ⭐ 用户高优先级
- 拖拽 item 到"粘贴盒"（类似购物车）
- 盒子底部显示：已选 X 项
- 粘贴选项：
  - 分隔方式：换行 / 不换行 / 自定义分隔符
  - 粘贴顺序：按选择顺序 / 按时间排序
- 支持预览合并后的效果
- 一键清空盒子
- 可选：粘贴后自动清空盒子

**跨应用拖拽**
- 直接从剪贴板窗口拖拽到任意应用
- 拖拽图片到 PS/Sketch
- 拖拽文本到编辑器

**临时收藏夹**
- 快速收藏当前需要用的几个 item
- 类似购物车概念
- 粘贴后自动清空或保留

---

### 7. 视觉体验 🎨

**动画优化**
- Item 出现时的渐入动画
- 复制成功时的视觉反馈（微动画）
- 删除时的滑出动画
- 列表滚动时的视差效果

**主题系统**
- 深色/浅色/跟随系统
- 自定义强调色
- 透明/毛玻璃效果开关

**字体设置**
- 调整字体大小（小/中/大）
- 等宽字体选项（适合代码）
- 字体家族选择

**布局选项**
- 紧凑模式 vs 舒适模式
- 列表视图 vs 网格视图（图片用网格更直观）
- 信息密度调节

---

### 8. 辅助功能 ♿

**无障碍支持**
- 完整的键盘导航支持
- 屏幕阅读器兼容
- 高对比度模式

**语音功能**
- 语音朗读文本内容（TTS）
- 语音搜索（说"找昨天复制的代码"）

**OCR 增强**
- 图片中的文字识别
- 识别后直接搜索图中文字
- 支持多语言 OCR

**翻译功能**
- 选中文本一键翻译
- 显示在预览面板中
- 支持多种翻译引擎

---

### 9. 系统集成 🔌

**快捷指令（macOS）**
- 创建 Siri 快捷指令
- "嘿 Siri，打开我的剪贴板"
- 自动化工作流集成

**分享功能**
- 一键分享到微信/钉钉/邮件
- 生成分享链接（临时）
- 导出为各种格式（txt、csv、json）

**Webhook/API**
- 支持自定义 webhook
- 复制特定内容时触发通知
- 与其他自动化工具集成（Zapier、IFTTT）

**云同步（远期）**
- 多设备同步剪贴板历史
- 端到端加密
- 选择性同步（只同步带"同步"标签的）

---

### 10. 安全隐私 🔒

**敏感内容检测**
- 自动检测密码、银行卡号、身份证号
- 敏感内容自动打"敏感"标签
- 敏感内容在预览时模糊显示

**密码保险箱模式**
- 检测到的密码存入加密区域
- 需要额外验证才能查看
- 定期提醒清理敏感数据

**隐私模式**
- 特定应用复制的内容不记录（如密码管理器）
- 一键开启/关闭
- 隐私内容 5 分钟后自动删除

**数据加密**
- 数据库本地加密
- 导出数据时加密
- 访问密码（可选）

---

### 11. 个性化 🎭

**欢迎页/空状态**
- 首次使用的引导教程
- 空状态时显示使用提示
- 统计卡片（已保存 X 条记录）

**成就系统**
- "复制了 100 次！"
- "连续使用 7 天"
- 增加一点趣味性

**自定义规则**
- 特定应用复制的内容自动打标签
- 特定格式的内容自动处理
- 例：复制 GitHub 链接 → 自动打"代码"标签

---

### 12. 实用小工具 🛠️

**文本处理**
- 一键去除格式（纯文本粘贴）
- 一键转换大小写
- 一键 URL 编码/解码
- 一键格式化 JSON
- 一键计算哈希值

**颜色工具**
- 检测复制内容中的颜色值
- 显示颜色预览块
- 颜色格式转换（HEX ↔ RGB ↔ HSL）

**链接检测**
- 自动检测文本中的链接
- 链接可点击直接打开
- 显示链接预览（标题+图标）

**二维码生成**
- 选中文本生成二维码
- 方便手机扫码获取

---

## 🎯 优先级投票区

如果你对这些功能感兴趣，可以在这里投票（用 ✓ 标记）：

### 最想做的 Top 5
- [x] 1. 键盘导航增强（↑↓Enter 粘贴）- **用户确认**
- [x] 2. 拼音/模糊搜索 - **用户确认**
- [x] 3. 批量操作（粘贴队列）- **用户确认**
- [x] 4. 抽屉式编辑器 - **用户确认**
- [x] 5. 跨应用拖拽 - **用户确认**
- [ ] 6. 智能分组（按时间）
- [ ] 7. 敏感内容检测
- [ ] 8. 深色主题
- [ ] 9. OCR 文字识别
- [ ] 10. 翻译功能

---

## 📝 灵感记录

**这里可以随手记录任何灵感：**

- 2026-02-06: 想到一个功能 - 复制 Excel 表格时，可以在预览里显示表格样式
- 2026-02-06: 想到一个功能 - 复制代码时，自动检测语言类型并语法高亮
- 2026-02-06: 想到一个功能 - 支持 Markdown 预览，复制 MD 文本可以渲染查看

**用户需求细化（2026-02-06）：**
- 粘贴队列：用户希望拖入盒子后，可以选择换行或不换行作为分隔符
- 抽屉编辑器：点击文本 item 弹出抽屉，可直接编辑内容，然后选择复制或粘贴
- 键盘导航：上下键导航 + Enter 粘贴，数字键 1-9 快速粘贴前9项

---
